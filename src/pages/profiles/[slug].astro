---
// src/pages/profiles/[slug].astro
import { getEntry, getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import ProfileLayout from '../../layouts/ProfileLayout.astro';

// (Recommended) Pre-build all profile pages
export async function getStaticPaths() {
  const profiles = await getCollection('profiles');
  return profiles.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

type ProfileEntry = CollectionEntry<'profiles'>;

const entry: ProfileEntry =
  // If you used getStaticPaths above, Astro.props.entry will be present:
  Astro.props.entry ??
  // Fallback (SSR / dev): fetch by slug
  (await getEntry('profiles', Astro.params.slug!))!;

if (!entry) {
  throw new Error(`Profile not found: ${Astro.params.slug}`);
}

const { Content } = await entry.render();
const { data } = entry;
---

<ProfileLayout data={data}>
  <Content />
</ProfileLayout>
